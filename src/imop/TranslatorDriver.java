package imop;
import imop.ast.node.external.Declaration;
import imop.lib.builder.Builder;
import imop.lib.util.DumpSnapshot;
import imop.parser.FrontEnd;
import imop.parser.Program;
public class TranslatorDriver {
	public static void main(String[] args) {
		Program.parseNormalizeInput(args);
		addToUDFs();
		Translator.closureVarName = Builder.getNewTempName("clsr_v");
		Translator.waitClosureVarName = Builder.getNewTempName("waitClsr_v");
		String declareClosure = "struct Clsr *"+Translator.closureVarName+";";
		Builder.addDeclarationToGlobals(MUWOmpConverter.indexFunction(Program.getRoot().getInfo().getMainFunction()),FrontEnd.parseAndNormalize(declareClosure,Declaration.class));
		MUWOmpConverter.nIterationsVarName = Builder.getNewTempName("nIters");
		MUWOmpConverter mUWOmpConverter = new MUWOmpConverter();
		MUWOmpConverter.populateSignalWaitCallInductionVariables();
		Translator translator = new Translator();
		mUWOmpConverter.setupEnvironment();
		translator.translate();
		DumpSnapshot.dumpRoot("processed");
	}
	public static void addToUDFs() {

		Translator.UDFs.add("createClosure");
		Translator.UDFs.add("cleanup");
		Translator.UDFs.add("COPYINT");
		Translator.UDFs.add("COPYFLOAT");
		Translator.UDFs.add("COPYDOUBLE");
		Translator.UDFs.add("COPYCHAR");
		Translator.UDFs.add("ADDINT");
		Translator.UDFs.add("ADDFLOAT");
		Translator.UDFs.add("ADDDOUBLE");
		Translator.UDFs.add("SUBINT");
		Translator.UDFs.add("SUBFLOAT");
		Translator.UDFs.add("myWaitSignalAll");
		Translator.UDFs.add("SUBDOUBLE");
		Translator.UDFs.add("MULINT");
		Translator.UDFs.add("MULFLOAT");
		Translator.UDFs.add("MULDOUBLE");
		Translator.UDFs.add("waitWrapper");
		Translator.UDFs.add("signalWrapper");
		Translator.UDFs.add("allocateMemoryForReduction");
		Translator.UDFs.add("buildReductionClosure");
		Translator.UDFs.add("performReduction");
		Translator.UDFs.add("DIVINT");
		Translator.UDFs.add("DIVFLOAT");
		Translator.UDFs.add("DIVDOUBLE");
		Translator.UDFs.add("createMessage");
		Translator.UDFs.add("createNode");
		Translator.UDFs.add("createQueue");
		Translator.UDFs.add("isEmpty");
		Translator.UDFs.add("deQueueMessage");
		Translator.UDFs.add("enQueueMessage");
		Translator.UDFs.add("incrementCounter");
		Translator.UDFs.add("decrementCounter");
		Translator.UDFs.add("checkPostbox");
		Translator.UDFs.add("receiveMessage");
		Translator.UDFs.add("postMessage");
		Translator.UDFs.add("initialisePostBox");
		Translator.UDFs.add("mySignalAllSend");
		Translator.UDFs.add("mySignalAll");
		Translator.UDFs.add("mySignalSend");
		Translator.UDFs.add("mySignal");
		Translator.UDFs.add("mSignalAll");
		Translator.UDFs.add("mSignal");
		Translator.UDFs.add("COPY");
		Translator.UDFs.add("ADD");
		Translator.UDFs.add("SUB");
		Translator.UDFs.add("MULT");
		Translator.UDFs.add("DIV");
		Translator.UDFs.add("myWaitAll");
		Translator.UDFs.add("myWait");
		Translator.UDFs.add("myWaitRed");
		Translator.UDFs.add("myWaitAllRed");
		Translator.UDFs.add("performReduction");
		Translator.UDFs.add("mWaitAll");
		Translator.UDFs.add("mWait");
		Translator.UDFs.add("executeWaitClosureAll");
		Translator.UDFs.add("executeWaitClosure");
		Translator.UDFs.add("createWaitClosureAll");
		Translator.UDFs.add("createWaitClosure");
		Translator.UDFs.add("createWorklistQueue");
		Translator.UDFs.add("createClosureNode");
		Translator.UDFs.add("isEmptyWorklist");
		Translator.UDFs.add("enqueueClosure");
		Translator.UDFs.add("dequeueClosure");
		Translator.UDFs.add("checkThreadStatus");
		Translator.UDFs.add("executeReadyWorkList");
		Translator.UDFs.add("scheduler");
		Translator.UDFs.add("lastFunction");
		Translator.UDFs.add("_OSSwapInt64");
		Translator.UDFs.add("_OSSwapInt32");
		Translator.UDFs.add("_OSSwapInt16");
		Translator.UDFs.add("__sputc");
		Translator.UDFs.add("__inline_isinfd");
		Translator.UDFs.add("__darwin_fd_set");
		Translator.UDFs.add("__inline_signbitf");
		Translator.UDFs.add("__sincospi");
		Translator.UDFs.add("__sincosf");
		Translator.UDFs.add("__inline_isnand");
		Translator.UDFs.add("__inline_isnormall");
		Translator.UDFs.add("__inline_signbitl");
		Translator.UDFs.add("printMatrix");
		Translator.UDFs.add("__inline_isnanl");
		Translator.UDFs.add("__sincospif");
		Translator.UDFs.add("__sincos");
		Translator.UDFs.add("__inline_isinfl");
		Translator.UDFs.add("__inline_isnormalf");
		Translator.UDFs.add("init");
		Translator.UDFs.add("getruntime");
		Translator.UDFs.add("__inline_isnanf");
		Translator.UDFs.add("__darwin_check_fd_set");
		Translator.UDFs.add("__inline_isfinitel");
		Translator.UDFs.add("__inline_isnormald");
		Translator.UDFs.add("__inline_isfinitef");
		Translator.UDFs.add("__inline_isinff");
		Translator.UDFs.add("__darwin_fd_isset");
		Translator.UDFs.add("__inline_signbitd");
		Translator.UDFs.add("__inline_isfinited");
		Translator.UDFs.add("__darwin_fd_clr");
		Translator.UDFs.add("handleReduction");
		Translator.UDFs.add("setupReduction");
		Translator.UDFs.add("waitWrapper");
		Translator.UDFs.add("signalWrapper");
		Translator.UDFs.add("mSignalAllReduce");
		Translator.UDFs.add("testAndDecPostbox");
	}

}
